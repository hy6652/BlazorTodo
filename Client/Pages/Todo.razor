@page "/todo"
@using BlazorTodo.Shared
@inject HttpClient http

<PageTitle>Todo</PageTitle>

<h3>Todo</h3>

@if (todos != null)
{
    <ul>
        @foreach (var todo in todos)
        {
            <li>
                <input type="checkbox" @bind="todo.IsDone" />
                <input @bind="todo.Title" />
                @*<button @onclick="() => DeleteTodo(todo)">Delete</button>*@
            </li>
        }
    </ul>
}



<input placeholder="Something todo" @bind="todo.Title" />
<button @onclick="CreateTodo">Add todo</button>

@code {
    TodoItem todo = new();

    public async Task CreateTodo()
    {
        todo.Id = Guid.NewGuid().ToString();
        todo.Pk = todo.Id;
        var httpResult = await http.PostAsJsonAsync<TodoItem>($"api/Todo/CreateTodo", todo);

        if (httpResult.IsSuccessStatusCode)
        {
            Console.WriteLine("SUCCESS");
        }
        else
        {
            Console.WriteLine(httpResult.ToString());    
        }
    }

    private TodoItem[]? todos;

    protected override async Task OnInitializedAsync()
    {
        todos = await http.GetFromJsonAsync<TodoItem[]>("api/Todo/GetAllTodo");
    }

    //private void DeleteTodo(TodoItem todo)
    //{
    //    todos.Remove(todo);
    //}
}